import{d as u,w as l}from"./CIQPcZhh.js";function g(){const s=l([]),o=l(null);if(typeof window<"u"){const e=localStorage.getItem("sessions");e&&s.set(JSON.parse(e));const t=localStorage.getItem("activeSession");t&&o.set(JSON.parse(t))}return s.subscribe(e=>{typeof window<"u"&&localStorage.setItem("sessions",JSON.stringify(e))}),o.subscribe(e=>{typeof window<"u"&&(e?localStorage.setItem("activeSession",JSON.stringify(e)):localStorage.removeItem("activeSession"))}),{sessions:{subscribe:s.subscribe},activeSession:{subscribe:o.subscribe},startSession:e=>{const t={id:`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,templateId:e.id,templateName:e.name,questions:e.questions,startTime:Date.now()};o.set(t)},endSession:e=>{let t=null;if(o.subscribe(r=>t=r)(),!t){console.error("No active session to end");return}const a=Date.now(),n=Math.floor((a-t.startTime)/1e3),i=t.questions[0]?.id,c=e[i]?.rating,d={id:t.id,templateId:t.templateId,templateName:t.templateName,startTime:t.startTime,endTime:a,duration:n,responses:e,overallRating:c};s.update(r=>[...r,d]),o.set(null)},cancelSession:()=>{o.set(null)},clearAllSessions:()=>{s.set([]),typeof window<"u"&&localStorage.removeItem("sessions")}}}const S=g(),f=u(S.sessions,s=>{if(s.length===0)return null;const o=s.filter(n=>n.overallRating!==void 0).map(n=>n.overallRating),e=o.length>0?o.reduce((n,i)=>n+i,0)/o.length:0,a=s.reduce((n,i)=>n+i.duration,0)/s.length;return{totalSessions:s.length,averageRating:e,averageDuration:a,sessions:s}});export{f as a,S as s};
