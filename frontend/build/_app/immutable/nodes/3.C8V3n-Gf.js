import"../chunks/DsnmJJEf.js";import{o as C,s as _}from"../chunks/CIQPcZhh.js";import{R as D,S as G,T as M,U as r,V as U,W as k,X as q,g as s,Y as b,Z as n,_ as l,$ as v,a0 as V}from"../chunks/trG2P9-e.js";import{i as S}from"../chunks/TCXrzA7w.js";import{E as W}from"../chunks/CYJaQVHj.js";import{s as w}from"../chunks/DrsKJ8O4.js";import{g as p,b as u}from"../chunks/UzgXwaK6.js";var X=b('<div class="submitting-overlay svelte-bqkhe3"><div class="submitting-content svelte-bqkhe3"><div class="spinner svelte-bqkhe3"></div> <p class="svelte-bqkhe3">Submitting your responses...</p></div></div>'),Y=b('<div class="page-container svelte-bqkhe3"><div class="page-header svelte-bqkhe3"><div class="session-badge svelte-bqkhe3"><span class="badge-icon svelte-bqkhe3">⏱️</span> Active Session</div> <h1 class="svelte-bqkhe3"> </h1> <p class="session-info svelte-bqkhe3"> </p></div> <!> <!></div>'),Z=b('<div class="loading svelte-bqkhe3"><div class="spinner svelte-bqkhe3"></div> <p class="svelte-bqkhe3">Loading session...</p></div>');function K(y,T){D(T,!0);let t=q(null),c=q(!1),d=0;C(()=>{const e=()=>{const a=w.activeSession.subscribe(i=>{console.log("Active session loaded:",i),k(t,i,!0)});return setTimeout(()=>{!s(t)&&d<3?(d++,console.log("Retrying to load session, attempt:",d),e()):s(t)||(console.error("No active session found after retries"),alert("No active session found. Please start a session first."),p(`${u}/`))},100),a};return e()});const x=async e=>{if(!s(c)){if(!s(t)){alert("Session was lost. Please try again."),p(`${u}/`);return}k(c,!0),console.log("Questionnaire responses:",e),console.log("Current active session:",s(t)),w.endSession(e),await new Promise(a=>setTimeout(a,500)),p(`${u}/?showGraphs=true`)}};var f=G(),A=M(f);{var N=e=>{var a=Y(),i=n(a),m=l(n(i),2),$=n(m,!0);v(m);var g=l(m,2),E=n(g);v(g),v(i);var h=l(i,2);W(h,{get template(){return s(t).questions},handleSubmit:x});var L=l(h,2);{var Q=o=>{var R=X();r(o,R)};S(L,o=>{s(c)&&o(Q)})}v(a),V(o=>{_($,s(t).templateName),_(E,`Started at ${o??""}`)},[()=>new Date(s(t).startTime).toLocaleTimeString()]),r(e,a)},P=e=>{var a=Z();r(e,a)};S(A,e=>{s(t)?e(N):e(P,!1)})}r(y,f),U()}export{K as component};
